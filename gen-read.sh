#!/bin/bash

cat > README.md << 'EOF'
# ğŸš€ Real-time Meme Coin Aggregator

A backend service that aggregates and deduplicates real-time meme coin data from multiple DEX APIs. Streams live price updates via WebSockets and supports sorting, filtering, and pagination like AxiomTrade.

---

## âš™ï¸ Tech Stack

- **Node.js + TypeScript**
- **Express.js** â€“ REST API
- **Socket.IO** â€“ Live updates
- **Redis** â€“ Caching layer (TTL 30s)
- **Axios** â€“ HTTP with retry + backoff
- **DexScreener** + **GeckoTerminal** APIs

---

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/        # External API handlers (DexScreener, GeckoTerminal)
â”‚   â”œâ”€â”€ cache/      # Redis client and caching logic
â”‚   â”œâ”€â”€ services/   # Core logic: merge, polling, streaming
â”‚   â”œâ”€â”€ routes/     # Express route handlers
â”‚   â”œâ”€â”€ utils/      # Retry logic, helpers
â”‚   â””â”€â”€ index.ts    # Entry point
â”œâ”€â”€ tests/          # Unit & integration tests
â””â”€â”€ README.md       # Generated by this script
```

---

## ğŸ“¡ API Endpoints

### `GET /api/v1/tokens`

> Fetch and merge token data from multiple sources (DexScreener, GeckoTerminal)  
> Supports filtering, sorting, and cursor-based pagination

**Query Parameters:**

| Param      | Required | Description                                        |
|------------|----------|----------------------------------------------------|
| `q`        | âœ… yes   | Token search (e.g. `bonk`)                          |
| `limit`    | âŒ no    | Max results (default: 10)                           |
| `cursor`   | âŒ no    | Token address to paginate from                     |
| `sort`     | âŒ no    | Field to sort on: `price_change`, `volume_sol`     |
| `order`    | âŒ no    | `asc` or `desc` (default: `desc`)                  |
| `interval` | âŒ no    | Time range: `1h`, `24h`, `7d` (default: `24h`)     |

---

## ğŸ” Route Examples & Descriptions

| URL | Description |
|-----|-------------|
| `http://localhost:5000/api/v1/tokens?q=bonk` | Basic token search for "bonk" |
| `http://localhost:5000/api/v1/tokens?q=bonk&sort=price_change&order=desc&interval=24h` | Sorted by 24h price change descending |
| `http://localhost:5000/api/v1/tokens?q=bonk&interval=1h` | 1-hour window stats for "bonk" |
| `http://localhost:5000/api/v1/tokens?q=bonk&sort=volume_sol&order=desc` | Sort tokens by trading volume |
| `http://localhost:5000/api/v1/tokens?q=usdt&limit=3&cursor=DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263` | Paginate results with a cursor (3 tokens only) |

ğŸ“¦ **Example:**

```bash
curl "http://localhost:5000/api/v1/tokens?q=bonk&sort=price_change&order=desc"
```

---

## ğŸ”Œ WebSocket Streaming

**Endpoint:** `ws://localhost:5000`  
**Event:** `token_update`

Emits live updates every 30 seconds for trending tokens

```typescript
const socket = io("http://localhost:5000");
socket.on("token_update", (data) => {
  console.log("ğŸ“ˆ Live Update:", data);
});
```

---

## ğŸ§  Live Polling Service

Start polling popular tokens (like Bonk, Doge, Pepe) in the background:

```bash
npm run poller
```

**Why?**
- Keeps the data hot in cache and emits live updates to connected clients via WebSocket.

---

## âš ï¸ GeckoTerminal 404 Error

You might see:

```
GeckoTerminal fetch failed: Request failed with status code 404
```

ğŸ” **Cause:**
- Token not indexed by GeckoTerminal yet (e.g. new meme coins)
- Invalid or unrecognized address

âœ… **Handled:**
- Gracefully falls back to DexScreener data
- Does not block overall result

---

## ğŸ§ª Testing

```bash
npm run test
```

âœ… **Covers:**
- REST routes (200, 400, 500 cases)
- Redis cache hits/misses
- Token merge logic (Dex + Gecko)
- WebSocket emit checks

---

## ğŸš€ Setup

```bash
git clone https://github.com/your-username/meme-aggregator.git
cd meme-aggregator
npm install
```

---

## ğŸŒ Environment

`.env` file:

```ini
PORT=5000
REDIS_URL=redis://localhost:6379
```

---

## ğŸ§¬ Run the Server

```bash
npm run dev     # Starts the API + WebSocket
npm run poller  # Starts live polling updates
```

---

## ğŸ¯ Deliverables

- âœ… REST API with filter, sort, cursor pagination
- âœ… Real-time WebSocket token updates
- âœ… Redis caching with TTL
- âœ… Rate-limit handling with retry/backoff
- â¬œ Postman Collection
- â¬œ 10+ Tests
- â¬œ Demo Video

---

## ğŸ“¸ Screenshots (to be added manually)

- âœ… REST API output (Postman)
- âœ… WebSocket console update
- âœ… Redis TTL proof via CLI (TTL key)
EOF

echo "âœ… README.md generated successfully!"
echo "ğŸ“„ File location: $(pwd)/README.md"
